## 도커(Docker)
### 1. 도커(Docker)란?
* 도커는 2013년 3월 출시된 오픈 소스 컨테이너 프로젝트이다.
* 도커는 Go 프로그래밍 언어로 작성되어 리눅스 컨테이너에 여러 기능을 추가해 애플리케이션을 개발, 실행하기 위한 플랫폼이다.
* 가상화 방법 중 하나인 가상 머신과는 다르게 도커 컨테이너는 게스트 OS를 설치하지 않아 가상 머신보다 이미지 용량이 크게 줄어 서비스 개발 및 운영 환경에 도커를 많이 사용하고 있다.
### 2. 도커의 구조
* 도커는 클라이언트-서버 아키텍처를 사용한다. 도커 클라이언트는 도커 컨테이너를 빌드, 실행 및 배포하는 작업을 수행하는 도커 데몬과 통신한다.
* 도커 이미지는 컨테이너를 만들고 실행하기 위한 읽기 전용 파일이다. 
* 도커 레지스트리(Docker Hub)는 도커 이미지를 저장하는 원격 저장소이다.
* 도커 컨테이너는 도커 이미지의 실행한 인스턴스로 컨테이너의 상태를 기반으로 새 이미지를 만들 수도 있다.
### 3. 도커(Docker) 설치하기
#### 3.1. 설치 전 확인 사항
* Windows Home 버전의 경우 WSL 2 기능을 지원하는 버전(20H1) 이상인지 확인한다.
* 작업 관리자 -> 성능 -> CPU 선택 후 가상화가 사용으로 표시되는지 확인한다. (표시가 되지 않을 경우 바이오스에서 가상화 설정을 바꿔주어야 한다.)
#### 3.2. WSL (Windows Subsystem for Linux)이란?
* 윈도우즈에서 경량 가상화 기술을 사용해 리눅스를 구동할 수 있도록 도와주는 기능이다.
* WSL를 이용하면 가상 머신을 사용하는 것보다 빠르게 윈도우즈 환경에서 리눅스 환경을 구축하여 사용할 수 있다.
#### 3.3. 다운로드 및 설치
* [Docker 공식 사이트](https://www.docker.com)에 접속 후 운영체제에 맞는 Docker Desktop Installer 다운로드 및 설치를 진행한다.
* 설치 후 명령 프롬프트에서 `docker -v` 명령어로 설치한 도커의 버전을 확인한다.
   ``` bash
   > docker -v
   > docker --version
   ```
## 도커 이미지(Docker Image)
### 1. 도커 이미지
* 모든 컨테이너는 이미지를 기반으로 생성이 된다. 
* 이미지는 컨테이너 실행에 필요한 파일과 설정값 등을 포함하고 있다.
### 2. 도커 허브(Docker Hub)
* 도커 허브(Docker Hub)는 도커에서 공식적으로 제공하는 이미지 저장소(레지스트리)이다.
* 도커 계정을 가지고 있으면 이미지를 올리고 내려받을 수 있다.
* 도커 이미지는 16진수로 된 ID로 구분하고 이미지의 이름은 ```[저장소 이름/]이미지 이름:[태그]```의 형태로 구성된다. 
   * 저장소 이름은 생략이 가능하며 이미지가 저장된 저장소를 의미한다. (저장소 이름 생략 시 도커허브 공식 이미지로 인식한다.)
   * 이미지 이름은 이미지의 역할에 따라 알맞은 이름을 지정해야 하며 이름은 생략할 수 없다. 
   * 태그는 일반적으로 버전을 명시하고 버전을 생략하면 도커는 이미지의 태그를 latest로 인식한다.
### 3. 이미지 검색
* [도커 허브 사이트](https://hub.docker.com)에 접속해서 어떤 이미지가 있는지 검색할 수 있다.
* ```docker search [키워드]``` 명령어로 이미지를 조회할 수 있다.
   * 명령어를 실행시킨 결과 NAME은 이미지 명을 나타낸다.
   * 명령어를 실행시킨 결과 DESCRIPTION은 이미지에 대한 설명을 나타낸다. 
   * 명령어를 실행시킨 결과 STARS는 도커 사용자로부터 얼마나 많은 즐겨찾기 되었는지 보여준다.
   * 명령어를 실행시킨 결과 OFFICIAL은 도커 허브에서 제공하는 공식 이미지 여부를 나타낸다. 
### 4. 이미지 다운로드 
* 도커는 기본적으로 도커 허브(Docker Hub)라 불리는 이미지 저장소(레지스트리)에서 이미지를 내려받는다. 
* ```docker pull [이미지 이름]:[태그]``` 명령어로 이미지를 내려받는다. 
* 태그는 생략이 가능하며 생략 시 최신 버전(latest)의 이미지를 내려받는다.
### 5. 다운로드한 이미지 목록 조회
* ```docker images [이미지 이름] ``` 명령어를 통해 도커 허브에서 내려받은 모든 이미지 목록을 출력할 수 있다.
* 명령어에서 이미지 이름은 내려받은 이미지 중에서 같은 이름을 가지는 이미지를 출력한다. (태그는 다를 수 있다.)
### 6. 이미지 세부 정보 출력
* ```docker image inspect [이미지 ID]``` 명령어를 통해 이미지의 세부 정보를 출력할 수 있다.
### 7. 이미지 추출
* 도커 이미지를 별도의 파일로 추출할 수 있다.
* ```docker save -o [추출할 파일 이름] [이미지 이름]:[태그]``` 명령어로 이미지를 파일로 추출할 수 있다.
### 8. 이미지 로드
* 추출된 이미지는 ```docker load -i [추출된 파일 이름]``` 명령어로 로드할 수 있다.
### 9. 이미지 이름 추가
* ```docker tag [기존 저장소/]기존 이미지[:기존 태그] [새로운 저장소/]새로운 이미지[:새로운 태그]``` 명령어로 기존 이미지에 새로운 이름을 추가할 수 있다.
* ```docker images``` 명령어로 확인하면 IMAGE ID는 같고 이름만 다르게 표시된다.
### 10. 이미지 삭제
* 내려받은 이미지를 삭제하기 위해서는 ```docker rmi [이미지 이름, 이미지 ID]``` 명령어로 삭제할 수 있다.
* 삭제하려는 이미지로 컨테이너가 생성되어 실행 중이면 삭제되지 않는다. 따라서 컨테이너를 먼저 중지 또는 삭제시킨 이후에 이미지를 삭제해야 한다.
### 11. 이미지 생성
* ```docker commit [옵션] [컨테이너 이름] [이미지 이름]:[태그]``` 명령어로 이미지를 생성한다.
* Dockerfile을 작성하고  ```docker build ``` 명령어로 이미지를 생성한다.
### 12. 이미지의 구조
* ```docker history [이미지 이름]``` 명령어로 이미지 레이어 구조를 출력할 수 있다.
* 도커는 commit 명령을 수행할 때마다 이미지를 통째로 생성하지 않고 바뀐 부분만 생성한다. 
* 생성된 이미지는 이전 이미지를 참조하는 방식으로 동작한다. 이를 도커에서는 레이어라고 한다.
* 즉, 컨테이너를 생성할 때 사용했던 이미지에서 바뀐 부분만 이미지로 생성하고 컨테이너를 생성할 때는 이전 레이어 이미지와 합쳐서 컨테이너를 생성하고 실행시킨다. 
### 13. 이미지 배포
* [도커 허브 사이트](https://hub.docker.com)에 접속하여 이미지 저장소 생성한다.
* ```docker login -u <사용자 계정>``` 명령어로 도커 허브에 로그인한다. (도커 허브 패스워드를 입력)
* ```docker push [이미지 이름]``` 명령어로 저장소에 이미지를 올릴 수 있다.
* 로그아웃을 해야 할 경우 ```docker logout``` 명령어를 사용한다.
## 도커 컨테이너(Docker Container)
### 1. 도커 컨테이너
* 도커 컨테이너는 도커 이미지를 실행한 상태를 말한다.
* 컨테이너는 이미지에서 변경된 사항만 컨테이너 계층에 저장하기 때문에 이미지에는 영향을 주지 않는다. 
* 특정 컨테이너에서의 작업은 다른 컨테이너와 호스트에는 영향을 주지 않는다.
### 2. 컨테이너 생성 및 실행
* ```docker run [옵션] [이미지 이름]``` 명령어로 컨테이너를 생성 및 실행할 수 있다.
* run 명령어는 컨테이너를 pull, create, start, attach 명령을 실행한다.
### 3. 컨테이너 목록 조회
* ```docker ps [옵션]``` 명령어로 컨테이너 목록을 확인할 수 있다.
* docker ps 명령어는 실행 중인 컨테이너만 출력하는데 -a 옵션을 통해서 모든 컨테이너를 조회할 수 있다.
### 4. 컨테이너 종료
* ```docker stop [컨테이너 이름 / 컨테이너 ID]``` 명령어로 컨테이너를 중지할 수 있다.
### 5. 컨테이너에서 명령어 실행
* ```docker exec [컨테이너 이름 / 컨테이너 ID] [명령]``` 명령어로 컨테이너에서 특정 명령을 실행할 수 있다.
### 6. 컨테이너 삭제
* ```docker rm [옵션] [컨테이너 이름]``` 명령어로 컨테이너를 삭제할 수 있다.
* 삭제한 컨테이너의 데이터는 복구할 수 없으므로 주의해야 한다.
* 실행 중인 컨테이너는 삭제할 수 없기 때문에 컨테이너를 정지시킨 후에 삭제하거나 -f 옵션을 추가하여 삭제한다.
### 7. 컨테이너 로그 출력
* ```docker logs [컨테이너 이름]``` 명령어로 컨테이너 로그를 출력할 수 있다.
* --tail 옵션을 사용해 마지막 로그 줄부터 출력할 줄의 수를 설정
* -f 옵션을 사용하면 컨테이너에서 실시간으로 출력되는 로그를 확인 가능
* -t는 날짜 시간을 찍어준다.
## 도커 볼륨(Docker Volume)
### 1. 도커 볼륨
* 도커 이미지로 컨테이너를 생성하면 컨테이너의 변경 사항만 컨테이너 계층에 저장되고 컨테이너를 삭제하면 컨테이너 계층에 있는 데이터도 함께 삭제된다. 
* 도커는 컨테이너가 삭제되어도 데이터를 유지할 수 있는 방법인 볼륨을 제공한다.
### 2. 호스트와 볼륨 공유
* 도커는 호스트의 디렉터리와 컨테이너의 디렉터리를 공유함으로써 컨테이너가 삭제되어도 데이터를 유지할 방법을 제공한다.
* 컨테이너 생성 시 ```-v [호스트 디렉터리] : [컨테이너 디렉터리]``` 옵션으로 호스트와 볼륨을 공유할 수 있다.
### 3. 도커 볼륨 활용
* 도커에서 제공하는 볼륨 기능을 이용해 데이터를 유지할 방법을 제공한다.
* ```docker volume create --name 볼륨 이름``` 명령어로 도커 볼륨을 생성할 수 있다.
* 컨테이너 생성 시 ```-v [볼륨 이름] : [컨테이너 디렉터리]``` 옵션으로 볼륨을 공유할 수 있다.
## 도커파일(Dockerfile)
### 1. 도커파일
* 도커파일(Dockerfile)은 도커 이미지를 생성하는 설정 파일이다.
* 개발자가 직접 컨테이너를 생성 후 이미지로 커밋하는 작업을 자동화한다. 
### 2. 도커파일 작성
* 도커파일에는 컨테이너에서 수행해야 할 작업을 ```[명령어] [매개값]```의 형태로 작성한다.
  * 작성된 명령어들은 위에서 아래로 작성된 순서대로 실행된다.
* 명령어 한 줄이 실행될 때마다 새로운 컨테이너를 생성하여 이미지로 ```commit``` 한다.
  * 이때 컨테이너를 만드는 이미지는 이전 명령어에서 생성된 이미지로 컨테이너를 생성한다.
* 일부 명령어는 JSON 배열의 형태로 사용할 수 있으며 명령어 부분은 소문자로 표기해도 상관은 없지만, 일반적으로 대문자로 표기한다. 
  ```dockerfile
  FROM ubuntu:latest
  RUN apt-get update
  RUN apt-get install sudo
  RUN sudo apt-get install net-tools 
  CMD ifconfig
  ```
### 3. 도커파일 빌드
* ```docker build --no-cache -f [도커파일 이름] -t [생성할 이미지 이름]:[태그] [도커파일 경로]``` 명령어로 이미지를 생성할 수 있다.
  * `-f` 옵션을 생략하는 경우 지정한 경로에서 `Dockerfile`이란 이름의 파일을 찾는다.
  * `-t` 옵션을 생략하는 경우 16진수 형태의 이름의 이미지가 생성된다.
  * `--no-cache` 옵션으로 빌드 시 캐시 사용하지 않도록 설정할 수 있다.
* 이미지를 생성할 때 지정하는 `도커파일 경로`에 해당하는 디렉터리를 `컨텍스트`라 한다.
   * 컨텍스트는 이미지를 생성하는데 필요한 데이터가 들어있는 디렉터리이다.
   * ADD와 COPY 명령어의 경우에 컨텍스트의 파일을 이미지에 추가하는 역할을 한다.
### 4. 도커파일 명령어
#### 4.1. FROM 명령어
* FROM 명령어는 도커파일(Dockerfile)로 생성할 이미지의 기반이 될 이미지를 설정할 때 사용한다. 
#### 4.2. LABEL 명령어
* LABEL 명령어는 도커파일(Dockerfile)로 생성되는 이미지에 메타데이터를 추가한다. 
* 메타데이터는 키=값의 형태로 저장되며, 여러 개의 메타데이터를 저장할 수 있으며 키, 값 내에 공백을 포함하려면 큰따옴표를 사용해야 한다.
#### 4.3. RUN 명령어
* RUN 명령어는 FROM 명령어에서 설정한 이미지로 생성되는 컨테이너 내부에서 명령어를 실행한다.
#### 4.4. ADD 명령어
* ```ADD [추가할 파일] [이미지에 추가될 경로]``` 명령어로 이미지에 파일을 추가할 수 있다.
* ADD 명령어는 외부 URL 및 tar 파일에서도 파일을 추가할 수 있다. 이때 tar 파일의 경우 파일을 그대로 추가하는 것이 아니라 압축을 풀어서 이미지에 추가한다.
* *, ?와 같은 와일드카드를 사용해서 파일을 지정할 수 있다.
#### 4.5. COPY 명령어
* ```COPY [추가할 파일] [이미지에 추가될 경로]``` 명령어로 이미지에 파일을 추가할 수 있다.
* COPY 명령어는 ADD 명령어와 다르게 컨텍스트로부터 파일을 추가하고 tar 파일을 추가할 때 압축을 풀지 않는다. 
* *, ?와 같은 와일드카드를 사용해서 파일을 지정할 수 있다.
#### 4.6. WORKDIR 명령어
* ```WORKDIR [경로]``` 명령어로 작업 디렉터리로 설정할 수 있다.
* 쉘에서 cd 명령어를 사용하는 것과 같은 기능을 한다.
#### 4.7. EXPOSE 명령어
* EXPOSE 명령어는 Dockerfile로 생성된 이미지로 컨테이너를 실행할 때 노출할 포트를 설정한다. 
* 컨테이너를 실행할 때 호스트의 포트와 바인딩 하려면 docker run 명령어에 -p 또는 -P 옵션을 사용해야 한다. 
#### 4.8. CMD 명령어
* CMD 명령어는 컨테이너가 시작될 때마다 실행할 명령을 설정한다.
* docker run 명령어에서 커맨드 부분과 같은 역할을 하며 CMD 명령어는 Dockerfile에서 한 번만 사용할 수 있다.
#### 4.9. ENTRYPOINT 명령어
* ENTRYPOINT 명령어는 컨테이너가 시작될 때마다 실행할 명령을 설정한다. 
* docker run 명령어의 --entrypoint 옵션과 같은 역할을 하며 ENTRYPOINT 명령어는 Dockerfile에서 한 번만 사용할 수 있다.
#### 4.10. CMD 명령어와 ENTRYPOINT 명령어를 함께 사용하기
* CMD 명령어와 ENTRYPOINT 명령어가 함께 설정되면 CMD 명령을 인자로 삼아서 ENTRYPOINT 명령어를 출력한다. 
* CMD와 ENTRYPOINT가 둘 다 설정되지 않으면 컨테이너는 생성되지 않고 에러를 출력하므로 반드시 둘 중 하나를 설정해야 한다.
#### 4.11. VOLUME 명령어
* VOLUME 명령어는 도커 볼륨을 사용하여 빌드 된 이미지로 컨테이너를 생성했을 때 호스트와 공유할 컨테이너 디렉터리를 설정한다.
#### 4.12. ENV 명령어
* ENV 명령어는 Dockerfile과 빌드 된 이미지로 생성된 컨테이너에서 사용할 수 있는 환경 변수를 설정한다.
* 설정된 환경 변수는 도커파일 내에서 `${환경 변수 이름}` 또는 `$환경 변수 이름`의 형태로 사용할 수 있다.
#### 4.13. ARG 명령어
* ARG 명령어는 docker build 명령어를 실행할 때, Dockerfile은 내부로 값을 전 받을 수 있는 변수를 선언할 수 있다. 
* ARG 명령어로 선언된 변수의 값은 build 명령어에서 입력받아야 하지만 기본 값을 미리 지정할 수도 있다. 
* docker build 명령어를 실행할 때 --build-arg 옵션을 사용해 "변수명=값" 형식으로 Dockerfile의 ARG 명령어로 선언된 변수에 값을 전달할 수 있다. 
* ARG로 설정된 값을 사용하는 방법은 ENV 명령어와 같다.
